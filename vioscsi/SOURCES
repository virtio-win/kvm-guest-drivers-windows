TARGETNAME=vioscsi
TARGETTYPE=MINIPORT

C_DEFINES = -D_MAJORVERSION_=$(_BUILD_MAJOR_VERSION_) $(C_DEFINES)
C_DEFINES = -D_MINORVERSION_=$(_BUILD_MINOR_VERSION_) $(C_DEFINES)
C_DEFINES = -D_NT_TARGET_MAJ=$(_NT_TARGET_MAJ) $(C_DEFINES)
C_DEFINES = -D_NT_TARGET_MIN=$(_RHEL_RELEASE_VERSION_) $(C_DEFINES)

C_DEFINES = -DMSI_SUPPORTED=1 $(C_DEFINES)
C_DEFINES = -DINDIRECT_SUPPORTED=1 $(C_DEFINES)
TARGETLIBS=$(SDK_LIB_PATH)\storport.lib $(SDK_LIB_PATH)\scsiwmi.lib ..\VirtIO\$(O)\virtiolib.lib

INF_NAME=vioscsi
NTTARGETFILE0=$(OBJ_PATH)\$(O)\$(INF_NAME).inf
#NTTARGETFILE1=vioscsidt.h
#NTTARGETFILE2=vioscsi.html
#NTTARGETFILE2=vioscsi.vbs
PASS0_BINPLACE=$(NTTARGETFILE0)

SOURCES= vioscsi.mof \
         vioscsi.c \
         utils.c \
         helper.c \
         vioscsi.rc \
         virtio_pci.c

MAJORCOMP=ntos

TARGETLIBS=$(TARGETLIBS) \
         $(SDK_LIB_PATH)\ntoskrnl.lib\
         $(SDK_LIB_PATH)\bufferoverflowk.lib\
         $(SDK_LIB_PATH)\wdm.lib

INCLUDES = $(INCLUDES);..\VirtIO;

BUFFER_OVERFLOW_CHECKS=1
MSC_WARNING_LEVEL=/W3 /WX

C_DEFINES = -DINDIRECT_SUPPORTED=1 $(C_DEFINES)

#ENABLE_EVENT_TRACING=1

# select one or none of those
#ENABLE_COM_DEBUG=1
#ENABLE_PRINT_DEBUG=1

!IFDEF ENABLE_COM_DEBUG
C_DEFINES = $(C_DEFINES) -DCOM_DEBUG
!ENDIF

!IFDEF ENABLE_PRINT_DEBUG
C_DEFINES = $(C_DEFINES) -DPRINT_DEBUG
!ENDIF

